!function e(t,n,o){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[a]={exports:{}};t[a][0].call(f.exports,function(e){var n=t[a][1][e];return i(n||e)},f,f.exports,e,t,n,o)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(e,t,n){!function(){"use strict";var t,o,i,r,a=e("./recorder.js"),s="Audio is not supported.";n.audioControl=function(e){e=e||{},this.checkAudioSupport=!1!==e.checkAudioSupport;var n=function(e){e=e||function(){},navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(o=a.audioRecorder()).requestDevice().then(function(t){e(i=!0)}).catch(function(t){e(i=!1)}):e(i=!1)};return this.checkAudioSupport&&n(),{startRecording:function(e,n,r){if(e=e||function(){},n=n||function(){},!(i=!1!==i))throw new Error(s);(t=o.createRecorder(r)).record(e,n)},stopRecording:function(){if(!(i=!1!==i))throw new Error(s);t.stop()},exportWAV:function(e,n){if(!(i=!1!==i))throw new Error(s);if(!e||"function"!=typeof e)throw new Error("You must pass a callback function to export.");n=void 0!==n?n:16e3,t.exportWAV(e,n)},play:function(e,n){if(void 0!==e){var i=new Blob([e]),a=new FileReader;a.onload=function(){r=o.audioContext().createBufferSource(),o.audioContext().decodeAudioData(this.result,function(e){r.buffer=e,r.connect(o.audioContext().destination),r.onended=function(e){"function"==typeof n&&n()},r.start(0)}),t.clear()},a.readAsArrayBuffer(i)}},stop:function(){void 0!==r&&r.stop()},clear:function(){t.clear()},playHtmlAudioElement:function(e,n){if(void 0!==e){var o=new Blob([e]),i=document.createElement("audio"),r=window.URL.createObjectURL(o);i.src=r,i.addEventListener("ended",function(){i.currentTime=0,"function"==typeof n&&n()}),i.play(),t.clear()}},supportsAudio:n}}}()},{"./recorder.js":5}],2:[function(e,t,n){!function(){"use strict";var t,o=e("./control.js").audioControl,i=Object.freeze({PASSIVE:"Passive",LISTENING:"Listening",SENDING:"Sending",SPEAKING:"Speaking"}),r=new o({checkAudioSupport:!1});n.conversation=function(e,n,o,s,c){var u;if(this.config=f(e),this.lexConfig=this.config.lexConfig,this.messages=i,n=n||function(){},this.onSuccess=o||function(){},this.onError=s||function(){},this.onAudioData=c||function(){},this.config.lexConfig.botName)if(AWS.config.credentials){if(AWS.config.region)return t=new AWS.LexRuntime,this.onSilence=function(){e.silenceDetection&&(r.stopRecording(),u.advanceConversation())},this.transition=function(e){var t=(u=e).state;n(t.message),t.message!==t.messages.SENDING&&t.message!==t.messages.SPEAKING||u.advanceConversation(),t.message!==t.messages.SENDING||this.config.silenceDetection||r.stopRecording()},this.advanceConversation=function(){r.supportsAudio(function(e){e?u.advanceConversation():s("Audio is not supported.")})},this.updateConfig=function(e){this.config=f(e),this.lexConfig=this.config.lexConfig},this.reset=function(){r.clear(),u=new a(u.state)},u=new a(this),{advanceConversation:this.advanceConversation,updateConfig:this.updateConfig,reset:this.reset};this.onError("A Region value must be provided.")}else this.onError("AWS Credentials must be provided.");else this.onError("A Bot name must be provided.")};var a=function(e){this.state=e,e.message=e.messages.PASSIVE,this.advanceConversation=function(){r.startRecording(e.onSilence,e.onAudioData,e.config.silenceDetectionConfig),e.transition(new s(e))}},s=function(e){this.state=e,e.message=e.messages.LISTENING,this.advanceConversation=function(){r.exportWAV(function(t){e.audioInput=t,e.transition(new c(e))})}},c=function(e){this.state=e,e.message=e.messages.SENDING,this.advanceConversation=function(){e.lexConfig.inputStream=e.audioInput,t.postContent(e.lexConfig,function(t,n){t?(e.onError(t),e.transition(new a(e))):(e.audioOutput=n,e.transition(new u(e)),e.onSuccess(n))})}},u=function(e){this.state=e,e.message=e.messages.SPEAKING,this.advanceConversation=function(){"audio/mpeg"===e.audioOutput.contentType?r.play(e.audioOutput.audioStream,function(){"ReadyForFulfillment"!==e.audioOutput.dialogState&&"Fulfilled"!==e.audioOutput.dialogState&&"Failed"!==e.audioOutput.dialogState&&e.config.silenceDetection?(r.startRecording(e.onSilence,e.onAudioData,e.config.silenceDetectionConfig),e.transition(new s(e))):e.transition(new a(e))}):e.transition(new a(e))}},f=function(e){(e=e||{}).silenceDetection=!e.hasOwnProperty("silenceDetection")||e.silenceDetection;var t=e.lexConfig||{};return t.botAlias=t.hasOwnProperty("botAlias")?t.botAlias:"$LATEST",t.botName=t.hasOwnProperty("botName")?t.botName:"",t.contentType=t.hasOwnProperty("contentType")?t.contentType:"audio/x-l16; sample-rate=16000",t.userId=t.hasOwnProperty("userId")?t.userId:"userId",t.accept=t.hasOwnProperty("accept")?t.accept:"audio/mpeg",e.lexConfig=t,e}}()},{"./control.js":1}],3:[function(e,t,n){(function(n){n.LexAudio=n.LexAudio||{},n.LexAudio.audioControl=e("./control.js").audioControl,n.LexAudio.conversation=e("./conversation.js").conversation,t.exports=n.LexAudio}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./control.js":1,"./conversation.js":2}],4:[function(e,t,n){var o=arguments[3],i=arguments[4],r=arguments[5],a=JSON.stringify;t.exports=function(e,t){function n(e){h[e]=!0;for(var t in i[e][1]){var o=i[e][1][t];h[o]||n(o)}}for(var s,c=Object.keys(r),u=0,f=c.length;u<f;u++){var d=c[u],l=r[d].exports;if(l===e||l&&l.default===e){s=d;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var p={},u=0,f=c.length;u<f;u++)p[d=c[u]]=d;i[s]=[Function(["require","module","exports"],"("+e+")(self)"),p]}var g=Math.floor(Math.pow(16,8)*Math.random()).toString(16),v={};v[s]=s,i[g]=[Function(["require"],"var f = require("+a(s)+");(f.default ? f.default : f)(self);"),v];var h={};n(g);var m="("+o+")({"+Object.keys(h).map(function(e){return a(e)+":["+i[e][0]+","+a(i[e][1])+"]"}).join(",")+"},{},["+a(g)+"])",w=window.URL||window.webkitURL||window.mozURL||window.msURL,A=new Blob([m],{type:"text/javascript"});if(t&&t.bare)return A;var x=w.createObjectURL(A),S=new Worker(x);return S.objectURL=x,S}},{}],5:[function(e,t,n){!function(){"use strict";var t,o,i=e("webworkify")(e("./worker.js")),r=function(e,t){(t=t||{}).time=t.hasOwnProperty("time")?t.time:1500,t.amplitude=t.hasOwnProperty("amplitude")?t.amplitude:.2;var n,o,r,a,s=!1,c=e.context.createScriptProcessor(4096,1,1);i.onmessage=function(e){var t=e.data;n(t)},i.postMessage({command:"init",config:{sampleRate:e.context.sampleRate}});var u=function(){s=!1},f=function(){d.fftSize=2048;var e=d.fftSize,n=new Uint8Array(e),i=t.amplitude,s=t.time;d.getByteTimeDomainData(n),"function"==typeof a&&a(n,e);for(var c=0;c<e;c++){var u=n[c]/128-1;(u>i||u<-1*i)&&(o=Date.now())}Date.now()-o>s&&r()};c.onaudioprocess=function(e){s&&(i.postMessage({command:"record",buffer:[e.inputBuffer.getChannelData(0)]}),f())};var d=e.context.createAnalyser();return d.minDecibels=-90,d.maxDecibels=-10,d.smoothingTimeConstant=.85,e.connect(d),d.connect(c),c.connect(e.context.destination),{record:function(e,t){r=e,a=t,o=Date.now(),s=!0},stop:u,clear:function(){u(),i.postMessage({command:"clear"})},exportWAV:function(e,t){n=e,i.postMessage({command:"export",sampleRate:t})}}};n.audioRecorder=function(){return{requestDevice:function(){return void 0===t&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,t=new AudioContext),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){o=e})},createRecorder:function(e){return r(t.createMediaStreamSource(o),e)},audioContext:function(){return t}}}}()},{"./worker.js":6,webworkify:4}],6:[function(e,t,n){t.exports=function(e){"use strict";function t(e){f=e.sampleRate}function n(e){l.push(e[0]),d+=e[0].length}function o(e){var t=u(r(a(l,d),e)),n=new Blob([t],{type:"application/octet-stream"});postMessage(n)}function i(){d=0,l=[]}function r(e,t){if(t===f)return e;for(var n=f/t,o=Math.round(e.length/n),i=new Float32Array(o),r=0,a=0;r<i.length;){for(var s=Math.round((r+1)*n),c=0,u=0,d=a;d<s&&d<e.length;d++)c+=e[d],u++;i[r]=c/u,r++,a=s}return i}function a(e,t){for(var n=new Float32Array(t),o=0,i=0;i<e.length;i++)n.set(e[i],o),o+=e[i].length;return n}function s(e,t,n){for(var o=0;o<n.length;o++,t+=2){var i=Math.max(-1,Math.min(1,n[o]));e.setInt16(t,i<0?32768*i:32767*i,!0)}}function c(e,t,n){for(var o=0;o<n.length;o++)e.setUint8(t+o,n.charCodeAt(o))}function u(e){var t=new ArrayBuffer(44+2*e.length),n=new DataView(t);return c(n,0,"RIFF"),n.setUint32(4,32+2*e.length,!0),c(n,8,"WAVE"),c(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,f,!0),n.setUint32(28,2*f,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),c(n,36,"data"),n.setUint32(40,2*e.length,!0),s(n,44,e),n}var f,d=0,l=[];e.addEventListener("message",function(e){switch(e.data.command){case"init":t(e.data.config);break;case"record":n(e.data.buffer);break;case"export":o(e.data.sampleRate);break;case"clear":i()}})}},{}]},{},[3]);